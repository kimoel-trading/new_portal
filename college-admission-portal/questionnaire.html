<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Program Recommender</title>
    <style>
        body { font-family: sans-serif; padding: 40px; background: #f4f4f4; }
        .container { background: white; padding: 30px; border-radius: 8px; max-width: 600px; margin: 0 auto; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        select, input[type="text"] { width: 100%; padding: 10px; }
        button { background: #007bff; color: white; padding: 12px 24px; border: none; cursor: pointer; width: 100%; font-size: 16px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
<div class="container">
    <h1>🤖 AI Program Recommender</h1>
    <p>Answer a few questions and our Gemini AI will match you with the best programs based on your preferences and interests.</p>

    <form action="process_recommendations.php" method="POST">
        <input type="hidden" name="student_strand" id="studentStrandInput" value="">

        <div class="form-group">
            <label>1. How do you prefer to work?</label>
            <select name="work_style" required>
                <option value="">Select your preference</option>
                <option value="analytical">I enjoy analyzing data, numbers, and solving complex problems (STEM/Research)</option>
                <option value="creative">I like designing, creating, and expressing ideas (Arts/Design/Architecture)</option>
                <option value="practical">I prefer hands-on work, building, and technical skills (Engineering Technology)</option>
                <option value="theoretical">I like studying theories, concepts, and advanced mathematics (Pure Engineering)</option>
                <option value="social">I want to help people and work with communities (Health/Education/Social Services)</option>
                <option value="business">I enjoy managing, organizing, and business strategies (Business/Accountancy)</option>
                <option value="digital">I like coding, programming, and working with technology (IT/Computer Science)</option>
                <option value="leadership">I want to teach, guide, and develop others (Education/Training)</option>
            </select>
        </div>

        <div class="form-group">
            <label>2. What specific topic interests you most?</label>
            <select name="topic_interest" required>
                <option value="">Select your interest</option>
                <option value="business_finance">Business, Finance, Accounting, or Entrepreneurship</option>
                <option value="engineering">Engineering, Construction, or Infrastructure</option>
                <option value="technology">Computers, Software, or Information Technology</option>
                <option value="health_medical">Health, Medicine, Nursing, or Nutrition</option>
                <option value="education">Teaching, Education, or Child Development</option>
                <option value="arts_design">Arts, Design, Architecture, or Visual Communication</option>
                <option value="science_research">Science, Research, Biology, or Chemistry</option>
                <option value="social_humanities">Psychology, Communication, or Social Sciences</option>
                <option value="environment_agriculture">Agriculture, Forestry, or Environmental Science</option>
                <option value="law_criminology">Law, Criminology, or Public Safety</option>
                <option value="hospitality_tourism">Hospitality, Tourism, or Service Industry</option>
                <option value="mathematics">Mathematics, Statistics, or Data Analysis</option>
                <option value="sports_fitness">Sports, Physical Education, or Fitness</option>
            </select>
        </div>

        <div class="form-group">
            <label>3. In one short sentence, what is your dream job?</label>
            <input type="text" name="dream_job" placeholder="e.g., I want to design eco-friendly houses." required>
        </div>

        <button type="submit">Find My Program</button>
    </form>
</div>

<script>
    // Load student's strand from localStorage
    document.addEventListener('DOMContentLoaded', function() {
        const studentStrand = localStorage.getItem('selected_strand') ||
                             localStorage.getItem('edu-strand') || 'gas';
        document.getElementById('studentStrandInput').value = studentStrand;
        console.log('Student strand loaded:', studentStrand);

        // Check for error parameters in URL
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get('error');
        const strand = urlParams.get('strand');

        if (error === 'strand_mismatch' && strand) {
            // Show error message for strand mismatch
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                background: #fee2e2;
                border: 1px solid #fecaca;
                color: #dc2626;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
                text-align: center;
                font-weight: 500;
            `;
            errorDiv.innerHTML = `
                <strong>❌ Strand Mismatch</strong><br>
                Sorry, your interests don't match with the <strong>${strand.toUpperCase()}</strong> strand you have taken.<br>
                Please reconsider your answers or contact your academic advisor.
            `;

            // Insert error message at the top of the form
            const form = document.querySelector('form');
            form.insertBefore(errorDiv, form.firstChild);

            // Scroll to top to show error
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Clear URL parameters after showing error
            setTimeout(() => {
                const newUrl = window.location.pathname;
                window.history.replaceState({}, document.title, newUrl);
            }, 1000);
        } else if (error === 'arts_strand_mismatch' && strand) {
            // Show specific error message for arts interests with incompatible strands
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                background: #fee2e2;
                border: 1px solid #fecaca;
                color: #dc2626;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
                text-align: center;
                font-weight: 500;
            `;
            errorDiv.innerHTML = `
                <strong>🎨 Arts/Design Interest Not Compatible</strong><br>
                Architecture and Design programs (like <strong>BS Architecture</strong>, <strong>BS Interior Design</strong>) are <strong>STEM-exclusive</strong>.<br>
                As a <strong>${strand.toUpperCase()}</strong> student, you cannot pursue arts/design programs at this university.<br><br>
                <strong>Suggestion:</strong> Consider Communication, Business, or Education programs that match your creative interests.
            `;

            // Insert error message at the top of the form
            const form = document.querySelector('form');
            form.insertBefore(errorDiv, form.firstChild);

            // Scroll to top to show error
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Clear URL parameters after showing error
            setTimeout(() => {
                const newUrl = window.location.pathname;
                window.history.replaceState({}, document.title, newUrl);
            }, 2000);
        } else if ((error === 'stem_strand_mismatch' || error === 'abm_strand_mismatch' || error === 'humss_strand_mismatch') && strand) {
            // Show comprehensive error message for any strand incompatibility
            const exclusiveStrand = urlParams.get('exclusive') || 'STEM';
            const programs = urlParams.get('programs') || 'specialized programs';

            let emoji = '🔬';
            let title = 'Interest Not Compatible';
            let suggestion = '';

            if (error === 'stem_strand_mismatch') {
                emoji = '🔬';
                title = 'STEM Interest Not Compatible';
                suggestion = 'Consider programs in your strand like Business, Communication, or Education.';
            } else if (error === 'abm_strand_mismatch') {
                emoji = '💼';
                title = 'Business Interest Not Compatible';
                suggestion = 'Consider programs in your strand like Communication, Psychology, or Education.';
            } else if (error === 'humss_strand_mismatch') {
                emoji = '📚';
                title = 'Education/Social Science Interest Not Compatible';
                suggestion = 'Consider programs in your strand like Business, Hospitality, or Technology.';
            }

            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                background: #fee2e2;
                border: 1px solid #fecaca;
                color: #dc2626;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
                text-align: center;
                font-weight: 500;
            `;
            errorDiv.innerHTML = `
                <strong>${emoji} ${title}</strong><br>
                ${programs} are <strong>${exclusiveStrand}-exclusive</strong>.<br>
                As a <strong>${strand.toUpperCase()}</strong> student, you cannot pursue these programs at this university.<br><br>
                <strong>Suggestion:</strong> ${suggestion}
            `;

            // Insert error message at the top of the form
            const form = document.querySelector('form');
            form.insertBefore(errorDiv, form.firstChild);

            // Scroll to top to show error
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Clear URL parameters after showing error
            setTimeout(() => {
                const newUrl = window.location.pathname;
                window.history.replaceState({}, document.title, newUrl);
            }, 3000);
        }
    });
</script>
</body>
</html>
